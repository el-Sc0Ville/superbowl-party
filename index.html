<script>
    // YOUR EXISTING SCRIPT URL (No change needed here)
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyvS3rvvRFbPEpM1EAuiPPC25dO5-HBmpf0YatIuD6RW57e0vlPm2D6Y4-TQqMQrkSMRQ/exec';

    function showSection(section) {
        document.getElementById('leaderboard-view').style.display = section === 'leaderboard' ? 'block' : 'none';
        document.getElementById('answers-view').style.display = section === 'answers' ? 'block' : 'none';
        
        document.getElementById('btn-board').className = section === 'leaderboard' ? 'nav-btn active' : 'nav-btn';
        document.getElementById('btn-answers').className = section === 'answers' ? 'nav-btn active' : 'nav-btn';
    }

    function loadData() {
        fetch(scriptURL)
            .then(response => response.json())
            .then(data => {
                const headers = data[0];
                const answers = data[1]; // The 'Answer Key' row
                const guests = data.slice(3); // Guests start at Row 4 (index 3)

                // --- 1. BUILD LEADERBOARD ---
                let players = guests.map(row => {
                    // Column A (0) is Name, Column B (1) is Score
                    return { name: row[0], score: row[1] === "" ? 0 : row[1] };
                });
                
                players = players.filter(p => p.name && p.name !== "");
                players.sort((a, b) => b.score - a.score);

                const tbody = document.getElementById('leaderboard-body');
                tbody.innerHTML = '';
                
                players.forEach((player, index) => {
                    let rankClass = '';
                    if (index === 0) rankClass = 'rank-1';
                    if (index === 1) rankClass = 'rank-2';
                    if (index === 2) rankClass = 'rank-3';

                    tbody.innerHTML += `
                        <tr class="${rankClass}">
                            <td>${index + 1}</td>
                            <td style="font-weight:500">${player.name}</td>
                            <td class="score-cell">${player.score}</td>
                        </tr>
                    `;
                });

                // --- 2. BUILD WINNERS PODIUM ---
                if (players.length > 0) {
                    const topScore = players[0].score;
                    const winners = players.filter(p => p.score === topScore);
                    
                    const winnerDiv = document.getElementById('winner-list');
                    winnerDiv.innerHTML = ''; 
                    
                    winners.forEach(w => {
                        winnerDiv.innerHTML += `
                            <div class="winner-name">${w.name}</div>
                            <div class="winner-score">${w.score} Points</div><br>
                        `;
                    });
                    document.getElementById('winners-podium').style.display = 'block';
                }

                // --- 3. BUILD ANSWER KEY (Updated for Column R!) ---
                const answerBody = document.getElementById('answers-body');
                answerBody.innerHTML = '';

                // UPDATED LOOP: Now goes up to 17 (Column R)
                let questionCount = 1;
                for (let i = 2; i <= 17; i++) { 
                    // Only show if there is actually a question in the header
                    if (headers[i] && headers[i] !== "") {
                        answerBody.innerHTML += `
                            <tr class="answer-key-row">
                                <td style="color:#888">${questionCount}</td>
                                <td>${headers[i]}</td>
                                <td style="text-align: right;" class="answer-correct">${answers[i]}</td>
                            </tr>
                        `;
                        questionCount++;
                    }
                }

            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('leaderboard-body').innerHTML = '<tr><td colspan="3">Error loading data.</td></tr>';
            });
    }
</script>
